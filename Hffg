-- SERVICES
local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- VARIABLES
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local aimbotEnabled = true
local aiming = false
local activeTouchId = nil

-- FIND CLOSEST PLAYER
local function getClosestPlayer()
    local closest = nil
    local shortestDistance = math.huge

    if not (LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")) then
        return nil
    end

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer
            and player.Character
            and player.Character:FindFirstChild("HumanoidRootPart")
            and player.Character:FindFirstChild("Humanoid")
            and player.Character.Humanoid.Health > 0 then

            local distance = (
                player.Character.HumanoidRootPart.Position -
                LocalPlayer.Character.HumanoidRootPart.Position
            ).Magnitude

            if distance < shortestDistance then
                shortestDistance = distance
                closest = player
            end
        end
    end

    return closest
end

local function getClosestPlayer()
    local closest = nil
    local shortestDistance = math.huge

    if not (LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")) then
        return nil
    end

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer
            and player.Character
            and player.Character:FindFirstChild("HumanoidRootPart")
            and player.Character:FindFirstChild("Humanoid")
            and player.Character.Humanoid.Health > 0
            -- TEAM CHECK
            and (player.Team ~= LocalPlayer.Team or LocalPlayer.Team == nil) then

            local distance = (
                player.Character.HumanoidRootPart.Position -
                LocalPlayer.Character.HumanoidRootPart.Position
            ).Magnitude

            if distance < shortestDistance then
                shortestDistance = distance
                closest = player
            end
        end
    end

    return closest
end


-- TOUCH INPUT
UIS.TouchStarted:Connect(function(input, gpe)
    if gpe or not aimbotEnabled then return end

    aiming = true
    activeTouchId = input.TouchId
end)

UIS.TouchEnded:Connect(function(input)
    if input.TouchId == activeTouchId then
        aiming = false
        activeTouchId = nil
    end
end)

-- CAMERA LOCK
RunService.RenderStepped:Connect(function()
    if aimbotEnabled and aiming then
        local target = getClosestPlayer()
        if target and target.Character then
            Camera.CFrame = CFrame.new(
                Camera.CFrame.Position,
                target.Character.HumanoidRootPart.Position
            )
        end
    end
end)
