-- SERVICES
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- STATES
local Holding = false

-- SETTINGS
_G.AimbotEnabled = true
_G.TeamCheck = true
_G.AimPart = "Head"
_G.Sensitivity = 0

------------------------------------------------
-- GET CLOSEST PLAYER TO CROSSHAIR
------------------------------------------------
local function GetClosestPlayer()
	local closest, maxDist = nil, math.huge
	local mousePos = UserInputService:GetMouseLocation()

	for _, player in ipairs(Players:GetPlayers()) do
		if player ~= LocalPlayer
		and player.Character
		and player.Character:FindFirstChild("Humanoid")
		and player.Character:FindFirstChild("HumanoidRootPart")
		and player.Character.Humanoid.Health > 0 then

			if _G.TeamCheck and player.Team == LocalPlayer.Team then
				continue
			end

			local screenPos, onScreen =
				Camera:WorldToViewportPoint(player.Character.HumanoidRootPart.Position)

			if onScreen then
				local dist = (Vector2.new(screenPos.X, screenPos.Y) - mousePos).Magnitude
				if dist < maxDist then
					maxDist = dist
					closest = player
				end
			end
		end
	end

	return closest
end

------------------------------------------------
-- MOBILE FIRE BUTTON (COMBAT ARENA STYLE)
------------------------------------------------
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

local FireGui = Instance.new("ScreenGui")
FireGui.Name = "FireGui"
FireGui.ResetOnSpawn = false
FireGui.Parent = PlayerGui

local FireButton = Instance.new("ImageButton")
FireButton.Size = UDim2.fromScale(0.17, 0.17)
FireButton.Position = UDim2.fromScale(0.78, 0.6)
FireButton.BackgroundTransparency = 1
FireButton.Image = "rbxassetid://7072718365" -- fire icon
FireButton.Parent = FireGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(1, 0)
corner.Parent = FireButton

-- HOLD TO AIM
FireButton.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.Touch
	or input.UserInputType == Enum.UserInputType.MouseButton1 then
		Holding = true
	end
end)

FireButton.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.Touch
	or input.UserInputType == Enum.UserInputType.MouseButton1 then
		Holding = false
	end
end)

UserInputService.InputBegan:Connect(function(Input)
    if Input.UserInputType == Enum.UserInputType.MouseButton2 then
        Holding = true
    end
end)

UserInputService.InputEnded:Connect(function(Input)
    if Input.UserInputType == Enum.UserInputType.MouseButton2 then
        Holding = false
    end
end)
-- Safety (finger slides off)
UserInputService.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.Touch then
		Holding = false
	end
end)

------------------------------------------------
-- AIMBOT LOOP (ONLY WHILE FIRE BUTTON HELD)
------------------------------------------------
RunService.RenderStepped:Connect(function()
    if Holding == true and _G.AimbotEnabled == true then
        TweenService:Create(Camera, TweenInfo.new(_G.Sensitivity, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {CFrame = CFrame.new(Camera.CFrame.Position, GetClosestPlayer().Character[_G.AimPart].Position)}):Play()
    end
end)
